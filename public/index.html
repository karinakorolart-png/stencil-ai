<script>
const form = document.getElementById("uploadForm");
const controls = document.getElementById("controls");
const preview = document.getElementById("preview");
const before = document.getElementById("before");
const after = document.getElementById("after");
const thicknessSlider = document.querySelectorAll(".slider")[0];
const darknessSlider = document.querySelectorAll(".slider")[1];
const updateBtn = document.getElementById("applyChanges");

let uploadedImage = null;

// Kui kasutaja laeb pildi Ã¼les
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const fileInput = document.querySelector('input[name="image"]');
  const file = fileInput.files[0];
  if (!file) return alert("Palun vali pilt!");

  const reader = new FileReader();
  reader.onload = function (event) {
    uploadedImage = event.target.result;
    before.src = uploadedImage;
    preview.style.display = "block";
    controls.style.display = "block";
  };
  reader.readAsDataURL(file);
});

// Kui kasutaja vajutab "Uuenda pilt"
updateBtn.addEventListener("click", async () => {
  if (!uploadedImage) return alert("Palun laadi enne pilt!");

  const response = await fetch("https://lineart.onrender.com/stencil", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      image: uploadedImage,
      thickness: parseFloat(thicknessSlider.value),
      darkness: parseFloat(darknessSlider.value),
    }),
  });

  if (!response.ok) {
    alert("TÃ¶Ã¶tlemisel tekkis viga ðŸ˜¢");
    return;
  }

  const data = await response.json();
  after.src = `data:image/png;base64,${data.stencil}`;
});
</script>
